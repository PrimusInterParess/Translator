#!/bin/sh
set -e

# Git provides pushed refs via STDIN:
# <local ref> <local sha> <remote ref> <remote sha>
should_build=0
while read local_ref local_sha remote_ref remote_sha
do
  case "$remote_ref" in
    refs/heads/master|refs/heads/main)
      should_build=1
      ;;
  esac
done

if [ "$should_build" -ne 1 ]; then
  exit 0
fi

repo_root="$(git rev-parse --show-toplevel)"
cd "$repo_root"

cmd.exe /c "rebuild.cmd"

